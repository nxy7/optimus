global:
  shell_cmd: bash -c

include:
  - ./frontend
  - ./backend 

# script that initializes your dev environment
init: |
  docker compose -f compose.yml -f compose.dev.yml up -d

# script that runs e2e tests
e2e_tests: 
  cmd: nu -c
  file: ./e2e_tests.nu

services:
  frontend:
    root: ./frontend
    dev:
      cmd: nu -c
      run: |
        pnpm i
        pnpm dev
    
  backend:
    root: ./backend
    dev:
      cmd: zsh -c
      file: ./start_dev.sh

  

    
  # dev: |
  #   sleep 5
  #   echo "20"
  #   docker ps
  # frontend:
  #   start:
  #   build: |
  #     docker build . -t streampai.frontend:latest
  #   push: |
  #     docker push streampai.frontend:latest
  #   dev:
  #   test:
  #     depends_on:
  #     - backend/main
  #     - backend/stream_chat

  # backend/main:
  #   build: |
  #     docker build . -t streampai.frontend:latest
  #   push: |
  #     docker push streampai.frontend:latest
  # backend/stream_chat:

purge: |
  echo "project cleanup commands
  for example:
  - docker compose down
  or
  - kubectl delete -f k3s/"

# project wide commands accessible via `optimus {command}`, in this example `optimus dbmigrate`
cmds:
  dbmigrate: |
    echo "Migrating database"
  tp-connect: |
    telepresence helm install
    telepresence connect